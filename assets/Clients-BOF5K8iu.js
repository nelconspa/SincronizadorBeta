import{_ as g,j as b,a as l,b as p,c as k,w as t,e as o,f as i,t as E,i as T,C as F,d as B,F as A,h as I,g as U}from"./index-BRhVHlva.js";import{_ as R}from"./SearchFilter-CeeZP-ln.js";import{i as $}from"./index-Btp5DDzO.js";import{u as x,r as S}from"./index-DamwJqBZ.js";import"./index-CP37Lqzs.js";import"./index-BlCPgDio.js";import"./index-BPAgsGrw.js";const O={name:"AddClient",props:{showAddModal:Boolean},setup(){return{v$:x()}},emits:["cerrarAddModal"],data(){return{form:{name:""},success:!1,fail:!1,successMsg:"",failMsg:""}},validations(){return{form:{name:{required:S}}}},methods:{restoreInitialData(){this.fail=!1,this.success=!1,this.failMsg="",this.successMsg=""},closeModal(){this.restoreInitialData(),this.$emit("cerrarAddModal"),this.form.name="",this.v$.$reset()},closeModalOutside(e){e.target===e.currentTarget&&this.closeModal()},setTouched(e){(e=="name"||e=="all")&&this.v$.form.name.$touch()},async saveClient(){if(this.setTouched("all"),!this.v$.$invalid)try{const e=await b.post(this.$store.state.backendUrl+"/clients",this.form,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});console.log(e),this.successMsg="Cliente creado exitósamente.",this.success=!0,setTimeout(()=>{this.closeModal()},2e3)}catch(e){if(e.response){const s=e.response.data.errors;for(const r in s)if(s.hasOwnProperty(r)){const d=s[r];this.failMsg=this.failMsg.concat(d,`
`),this.fail=!0,setTimeout(()=>{this.restoreInitialData()},2e3)}}}}}};function P(e,s,r,d,a,n){const f=l("CModalTitle"),u=l("CModalHeader"),h=l("CAlert"),C=l("CFormInput"),m=l("CForm"),_=l("CModalBody"),c=l("CButton"),D=l("CModalFooter"),v=l("CModal");return p(),k(v,{visible:r.showAddModal,onClose:n.closeModal},{default:t(()=>[o(u,null,{default:t(()=>[o(f,null,{default:t(()=>[i("Nuevo Cliente")]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(h,{color:"success",visible:a.success},{default:t(()=>[i(E(a.successMsg),1)]),_:1},8,["visible"]),o(m,null,{default:t(()=>[o(C,{type:"text",placeholder:"Nombre","aria-describedby":"Nombre Cliente",onInput:s[0]||(s[0]=M=>n.setTouched("name")),modelValue:a.form.name,"onUpdate:modelValue":s[1]||(s[1]=M=>a.form.name=M),feedback:"Rellene este campo por favor.",invalid:d.v$.form.name.$error},null,8,["modelValue","invalid"])]),_:1})]),_:1}),o(D,null,{default:t(()=>[o(c,{color:"secondary",onClick:n.closeModal},{default:t(()=>[i(" Cerrar ")]),_:1},8,["onClick"]),o(c,{color:"primary",onClick:n.saveClient},{default:t(()=>[i("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["visible","onClose"])}const G=g(O,[["render",P]]),L={name:"DeleteModal",emits:["closeDeleteModal"],props:{showDeleteModal:Boolean,client:Object},data(){return{fail:!1,success:!1}},methods:{closeModal(){this.$emit("closeDeleteModal"),this.fail=!1,this.sucess=!1},deleteClient(){this.client.client_configs.length?this.fail=!0:b.delete(this.$store.state.backendUrl+"/clients/"+this.client.id,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}}).then(e=>{console.log(e),this.success=!0}).catch(e=>{console.log("Error: ",e)})}}};function q(e,s,r,d,a,n){const f=l("CModalTitle"),u=l("CModalHeader"),h=l("CModalBody"),C=l("CAlert"),m=l("CButton"),_=l("CModalFooter"),c=l("CModal");return p(),k(c,{visible:r.showDeleteModal,onClose:n.closeModal},{default:t(()=>[o(u,null,{default:t(()=>[o(f,null,{default:t(()=>[T(e.$slots,"modalTitle")]),_:3})]),_:3}),o(h,null,{default:t(()=>[T(e.$slots,"modalBody")]),_:3}),o(_,null,{default:t(()=>[o(C,{color:"danger",visible:a.fail},{default:t(()=>[i(" Para eliminar este cliente no debe tener estaciones agregadas. ")]),_:1},8,["visible"]),o(C,{color:"success",visible:a.success},{default:t(()=>[i(" Cliente eliminado exitósamente. ")]),_:1},8,["visible"]),o(m,{onClick:n.deleteClient,color:"danger",class:"text-white"},{default:t(()=>[i("Eliminar ")]),_:1},8,["onClick"]),o(m,{color:"primary",onClick:n.closeModal},{default:t(()=>[i("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:3},8,["visible","onClose"])}const J=g(L,[["render",q]]),K={name:"EditUser",components:{CIcon:F,DeleteModal:J},emits:["update:showEditModal","cerrarEditModal"],props:{showEditModal:Boolean,client:Object},setup(){return{v$:x(),icon:$}},validations(){return{form:{name:{required:S}}}},data(){return{form:{id:"",name:""},showDeleteModal:!1,success:!1,fail:!1,successMsg:"",failMsg:""}},emits:["onUpdate:showEditModal","cerrarEditModal"],watch:{client:{handler(e){this.setDataClient(e)},deep:!0,immediate:!0},showEditModal(e){e||this.$emit("update:showEditModal")}},methods:{setTouched(e){(e=="name"||e=="all")&&this.v$.form.name.$touch()},handleDeleteModal(){this.showDeleteModal=!0},restoreInitialData(){this.fail=!1,this.success=!1,this.failMsg="",this.successMsg=""},closeModal(){this.restoreInitialData(),this.$emit("cerrarEditModal")},closeModalOutside(e){e.target===e.currentTarget&&this.closeModal()},setDataClient(e){e&&(console.log(e),this.form.id=e.id,this.form.name=e.name)},async saveClient(){if(this.setTouched("all"),!this.v$.$invalid)try{const e=await b.put(this.$store.state.backendUrl+"/clients/"+this.form.id,this.form,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});console.log(e),this.successMsg="Cliente actualizado exitósamente.",this.success=!0,setTimeout(()=>{this.closeModal()},2e3)}catch(e){if(e.response){const s=e.response.data.errors;for(const r in s)if(s.hasOwnProperty(r)){const d=s[r];this.failMsg=this.failMsg.concat(d,`
`),this.fail=!0,setTimeout(()=>{this.restoreInitialData()},2e3)}}}},onCloseDeleteModal(){console.log("cerre modal Delete Modal"),this.showDeleteModal=!1}}},Q=I("b",null,"ADVERTENCIA:",-1);function W(e,s,r,d,a,n){const f=l("CModalTitle"),u=l("CModalHeader"),h=l("CAlert"),C=l("CFormInput"),m=l("CForm"),_=l("CModalBody"),c=l("CButton"),D=l("CModalFooter"),v=l("CModal"),M=l("DeleteModal");return p(),B(A,null,[o(v,{visible:r.showEditModal,onClose:n.closeModal},{default:t(()=>[o(u,null,{default:t(()=>[o(f,null,{default:t(()=>[i("Editar Cliente")]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(h,{color:"success",visible:a.success},{default:t(()=>[i(E(a.successMsg),1)]),_:1},8,["visible"]),o(m,{class:"mt-3"},{default:t(()=>[o(C,{type:"text",placeholder:"Nombre","aria-describedby":"Nombre Cliente",modelValue:a.form.name,"onUpdate:modelValue":s[0]||(s[0]=w=>a.form.name=w),onInput:s[1]||(s[1]=w=>n.setTouched("name")),feedback:"Rellene este campo por favor.",invalid:d.v$.form.name.$error,class:"mt-3"},null,8,["modelValue","invalid"])]),_:1})]),_:1}),o(D,null,{default:t(()=>[o(c,{color:"secondary",onClick:n.closeModal},{default:t(()=>[i(" Cerrar ")]),_:1},8,["onClick"]),o(c,{color:"primary",onClick:n.saveClient},{default:t(()=>[i("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["visible","onClose"]),o(M,{showDeleteModal:a.showDeleteModal,onCloseDeleteModal:n.onCloseDeleteModal,client:a.form},{modalTitle:t(()=>[i("Eliminar Cliente")]),modalBody:t(()=>[Q,i(" Se eliminarán todos los datos de este cliente. ")]),modalFooter:t(()=>[]),_:1},8,["showDeleteModal","onCloseDeleteModal","client"])],64)}const X=g(K,[["render",W]]),Y={name:"DeleteModal",emits:["closeDeleteModal"],props:{showDeleteModal:Boolean,client:Object,devices:Array},data(){return{fail:!1,success:!1}},methods:{closeModal(){this.$emit("closeDeleteModal"),this.fail=!1,this.success=!1},deleteClient(){this.devices.forEach(e=>{e.client_id===this.client.id&&(console.log(e.client_id),this.fail=!0)}),this.fail||b.delete(this.$store.state.backendUrl+"/clients/"+this.client.id,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}}).then(e=>{console.log(e),this.success=!0}).catch(e=>{console.log("Error: ",e)})}}};function Z(e,s,r,d,a,n){const f=l("CModalTitle"),u=l("CModalHeader"),h=l("CModalBody"),C=l("CAlert"),m=l("CButton"),_=l("CModalFooter"),c=l("CModal");return p(),k(c,{visible:r.showDeleteModal,onClose:n.closeModal},{default:t(()=>[o(u,null,{default:t(()=>[o(f,null,{default:t(()=>[T(e.$slots,"modalTitle")]),_:3})]),_:3}),o(h,null,{default:t(()=>[T(e.$slots,"modalBody")]),_:3}),o(_,null,{default:t(()=>[o(C,{color:"danger",visible:a.fail},{default:t(()=>[i(" Para eliminar este cliente no debe tener estaciones agregadas. ")]),_:1},8,["visible"]),o(C,{color:"success",visible:a.success},{default:t(()=>[i(" Cliente eliminado exitósamente. ")]),_:1},8,["visible"]),o(m,{onClick:n.deleteClient,color:"danger",class:"text-white"},{default:t(()=>[i("Eliminar ")]),_:1},8,["onClick"]),o(m,{color:"primary",onClick:n.closeModal},{default:t(()=>[i("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:3},8,["visible","onClose"])}const ee=g(Y,[["render",Z]]),oe={name:"Clients",components:{SearchBarFilter:R,CIcon:F,AddClientModal:G,EditClientModal:X,DeleteClient:ee},setup(){return{icon:$}},data(){return{clients:[],devices:[],searchFilter:"",showAddModal:!1,showEditModal:!1,showDeleteModal:!1,client_id:null}},computed:{filteredClients(){let e=this.clients;return this.searchFilter!==""&&(e=e.filter(s=>s.name.toLowerCase().includes(this.searchFilter.toLowerCase()))),e}},mounted(){this.getClients()},methods:{editClient(e){this.showEditModal=!0,this.client_id=e},async deleteClient(e){this.showDeleteModal=!0,this.client_id=e;try{await this.getDevices(this.client_id.id),console.log("Devices client: ",this.devices)}catch(s){console.error("Error al obtener dispositivos en deleteClient button:",s)}},addClient(){this.showAddModal=!0},handleSearch(e){this.searchFilter=e},async getDevices(e){try{const s=await b.get(this.$store.state.backendUrl+"/devices",{params:{client:!0,client_id:e},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});return this.devices=s.data,this.devices;console.log("DEVICES GETDEVICES: ",this.devices)}catch(s){console.error("Error en la solicitud a la API:",s),this.ShowError=!0}},async getClients(){try{const e=await b.get(this.$store.state.backendUrl+"/clients",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.clients=e.data,console.log(this.clients[0])}catch(e){console.error("Error en la solicitud a la API:",e),this.ShowError=!0}},onCloseAdd(){this.showAddModal=!1,this.getClients()},onCloseEdit(){console.log("cerré modal editClient"),this.showEditModal=!1,this.getClients()},onCloseDeleteModal(){console.log("cerre modal Delete Modal"),this.showDeleteModal=!1,this.getClients()}}};function te(e,s,r,d,a,n){const f=l("CIcon"),u=l("CButton"),h=l("CCol"),C=l("SearchBarFilter"),m=l("CRow"),_=l("CTableHeaderCell"),c=l("CTableRow"),D=l("CTableHead"),v=l("CTableDataCell"),M=l("font-awesome-icon"),w=l("CTableBody"),V=l("CTable"),H=l("AddClientModal"),N=l("EditClientModal"),j=l("DeleteClient");return p(),B(A,null,[o(m,{class:"mb-4"},{default:t(()=>[o(h,{class:"col-3 mt-4"},{default:t(()=>[o(u,{onClick:n.addClient,color:"success",shape:"rounded-pill",variant:"outline"},{default:t(()=>[o(f,{icon:d.icon.cilPlus,size:"xl"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),o(h,{class:"col-9"},{default:t(()=>[o(C,{onSearch:n.handleSearch},null,8,["onSearch"])]),_:1})]),_:1}),o(V,{class:"mt-5"},{default:t(()=>[o(D,null,{default:t(()=>[o(c,{color:"dark"},{default:t(()=>[o(_,{scope:"col"},{default:t(()=>[i("Nombre")]),_:1}),o(_,{scope:"col"},{default:t(()=>[i("Herramientas")]),_:1})]),_:1})]),_:1}),o(w,null,{default:t(()=>[(p(!0),B(A,null,U(n.filteredClients,(y,le)=>(p(),k(c,{key:y.id},{default:t(()=>[o(v,null,{default:t(()=>[i(E(y.name),1)]),_:2},1024),o(v,null,{default:t(()=>[o(u,{onClick:z=>n.editClient(y)},{default:t(()=>[o(M,{icon:"pen-to-square",size:"xl"})]),_:2},1032,["onClick"]),o(u,{onClick:z=>n.deleteClient(y)},{default:t(()=>[o(M,{icon:"trash",size:"xl"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(H,{showAddModal:a.showAddModal,onCerrarAddModal:n.onCloseAdd},null,8,["showAddModal","onCerrarAddModal"]),o(N,{showEditModal:a.showEditModal,client:a.client_id,onCerrarEditModal:n.onCloseEdit},null,8,["showEditModal","client","onCerrarEditModal"]),o(j,{showDeleteModal:a.showDeleteModal,onCloseDeleteModal:n.onCloseDeleteModal,client:a.client_id,devices:a.devices},{modalTitle:t(()=>[i("Eliminar Cliente: "),I("b",null,E(a.client_id.name),1)]),modalBody:t(()=>[i(" ADVERTENCIA: Se eliminarán todos los datos de este cliente. ")]),modalFooter:t(()=>[]),_:1},8,["showDeleteModal","onCloseDeleteModal","client","devices"])],64)}const ue=g(oe,[["render",te]]);export{ue as default};
