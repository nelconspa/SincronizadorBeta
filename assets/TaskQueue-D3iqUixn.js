import{_ as E,j as f,d as g,e,w as t,F as D,a as n,b as _,f as a,g as A,h as N,c as m,t as r}from"./index-3SSTsJ3w.js";import{D as z,C as Q,a as x}from"./DeviceFilter-CtwBT3Q3.js";const S={name:"TaskQueue",components:{DatePicker:z,ClientFilter:Q,DeviceFilter:x},data(){return{tasksQueue:[],clientSelected:"",clients:[],devices:[],clientsFilter:[],devicesFilter:[],dateRange:[null,null],formatDates:[null,null]}},mounted(){const l=new Date;this.dateRange=[l,l]},methods:{getStepName(l){let o;switch(l){case 1:o="En cola zeus";break;case 2:o="En cola DGA";break;case 3:o="Finalizado";break;default:o=""}return o},handleDate(l){this.dateRange=l.map(o=>o instanceof Date?`${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}`:o),console.log("RANGE DATA: ",this.dateRange)},async getQueueTasks(){let l,o;l=this.dateRange[0],o=this.dateRange[1],this.devices=this.devicesFilter.map(d=>d.id);try{let d={clients:this.clientsFilter,devices:this.devices,date1:l,date2:o};const C=await f.get(this.$store.state.backendUrl+"/tasks",{params:d,headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.tasksQueue=C.data,console.log(this.tasksQueue)}catch(d){console.error("Error en la solicitud a la API:",d),this.ShowError=!0}},handleClients(l){this.clientsFilter=l,this.getDevicesByClients()},handleDevices(l){this.devicesFilter=l,console.log("Devices: ",this.devicesFilter),this.getDevicesByClients()},async getDevices(){try{const l=await f.get(this.$store.state.backendUrl+"/devices",{client:!0,client_id:2,headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.devices=l.data,console.log(this.devices)}catch(l){console.error("Error en la solicitud a la API:",l),this.ShowError=!0}},async getDevicesByClients(){try{let l=[];for(const o of this.clientsFilter){const d=await f.get(this.$store.state.backendUrl+"/devices",{params:{client_id:o,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});l=l.concat(d.data)}this.devicesFilter=l}catch(l){console.error("Error en la solicitud a la API:",l),this.ShowError=!0}}}},V=N("label",{class:"form-label"},"Fecha",-1);function H(l,o,d,C,h,u){const F=n("DatePicker"),p=n("CCol"),b=n("ClientFilter"),T=n("DeviceFilter"),k=n("CButton"),y=n("CRow"),i=n("CTableHeaderCell"),v=n("CTableRow"),B=n("CTableHead"),c=n("CTableDataCell"),w=n("CTableBody"),R=n("CTable");return _(),g(D,null,[e(y,null,{default:t(()=>[e(p,null,{default:t(()=>[V,e(F,{modelValue:h.dateRange,"onUpdate:modelValue":[o[0]||(o[0]=s=>h.dateRange=s),u.handleDate],placeholder:"Escoja un rango de fechas",range:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(p,{class:"col-3"},{default:t(()=>[e(b,{onFilter:u.handleClients},null,8,["onFilter"])]),_:1}),e(p,{class:"col-3"},{default:t(()=>[e(T,{allDevices:h.devicesFilter,onFilter:u.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),e(p,{class:"mt-4"},{default:t(()=>[e(k,{color:"primary",onClick:u.getQueueTasks,class:"mt-1"},{default:t(()=>[a(" Buscar ")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(R,{class:"mt-5"},{default:t(()=>[e(B,null,{default:t(()=>[e(v,{color:"dark"},{default:t(()=>[e(i,{scope:"col"},{default:t(()=>[a("Estado")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Cliente")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Fecha")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Hora")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Dispositivo")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Nivel Freatico")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Caudal")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Totalizador")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Fecha MediciÃ³n")]),_:1}),e(i,{scope:"col"},{default:t(()=>[a("Comprobante DGA")]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[(_(!0),g(D,null,A(h.tasksQueue,(s,P)=>(_(),m(v,{key:s.id},{default:t(()=>[e(c,null,{default:t(()=>[a(r(u.getStepName(s.step)),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.client.name),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.taskDate),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.taskHour),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.device.zeusName),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.device.channelNivelFreatico),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.device.channelCaudal),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.device.channelTotalizador),1)]),_:2},1024),e(c,null,{default:t(()=>[a(r(s.zeusDate),1)]),_:2},1024),s.dgaNumeroComprobante!==null?(_(),m(c,{key:0},{default:t(()=>[a(r(s.dgaNumeroComprobante),1)]),_:2},1024)):(_(),m(c,{key:1}))]),_:2},1024))),128))]),_:1})]),_:1})],64)}const $=E(S,[["render",H]]);export{$ as default};
