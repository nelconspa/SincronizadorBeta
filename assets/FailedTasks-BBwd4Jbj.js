import{_ as V,j as v,d as F,e as t,w as l,h as n,F as w,a,b as h,f as i,g as E,c as m,t as u}from"./index-CMiWk7nc.js";import{D as N,C as H,a as L}from"./DeviceFilter-LrvMj8KR.js";import{_ as M}from"./SearchFilter-D71uR4vq.js";const I={name:"FailedTasks",components:{DatePicker:N,ClientFilter:H,DeviceFilter:L,SearchBarFilter:M},data(){return{failTasks:[],showModal:[],searchFilter:"",clientsFilter:[],devicesFilter:[],totalDevices:[],perPage:10,currentPage:1,totalPages:0}},computed:{displayedTasks(){const e=(this.currentPage-1)*this.perPage,s=e+this.perPage;return this.filteredTasks.slice(e,s)},filteredTasks(){let e=this.failTasks;return this.clientsFilter.length>0&&(e=e.filter(s=>this.clientsFilter.includes(s.last_error.client_id))),this.devicesFilter.length>0&&this.devicesFilter.length<this.totalDevices.length&&(e=e.filter(s=>this.devicesFilter.includes(s.last_error.device_id))),this.searchFilter!==""&&(e=e.filter(s=>s.device&&s.device.zeusName.toLowerCase().includes(this.searchFilter.toLowerCase())||s.client&&s.client.name.toLowerCase().includes(this.searchFilter.toLowerCase()))),e}},watch:{filteredTasks(){this.totalPages=Math.ceil(this.filteredTasks.length/this.perPage)}},mounted(){this.getFailedTasks()},methods:{handleSearch(e){this.searchFilter=e},handleClients(e){this.clientsFilter=e,this.getDevicesByClients()},handleDevices(e){this.devicesFilter=e,console.log("DEVICES: ",e)},async getFailedTasks(){const e=await v.get(this.$store.state.backendUrl+"/syncManual",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.failTasks=e.data,console.log(this.failTasks)},async getDevicesByClients(){try{let e=[];for(const s of this.clientsFilter){const g=await v.get(this.$store.state.backendUrl+"/devices",{params:{client_id:s,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});e=e.concat(g.data.map(f=>({...f,host:f.client_config.zeusHost})))}this.totalDevices=e,this.devicesFilter=e}catch(e){console.error("Error en la solicitud a la API:",e),this.ShowError=!0}}}},R={class:"style-pagination mt-5"},j=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1),A=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1);function U(e,s,g,f,_,c){const T=a("ClientFilter"),p=a("CCol"),b=a("DeviceFilter"),k=a("SearchBarFilter"),D=a("CButton"),y=a("CRow"),d=a("CTableHeaderCell"),C=a("CTableRow"),B=a("CTableHead"),r=a("CTableDataCell"),x=a("CTableBody"),P=a("CTable"),S=a("vue-awesome-paginate");return h(),F(w,null,[t(y,null,{default:l(()=>[t(p,{class:"col-3"},{default:l(()=>[t(T,{onFilter:c.handleClients},null,8,["onFilter"])]),_:1}),t(p,{class:"col-3"},{default:l(()=>[t(b,{allDevices:_.devicesFilter,onFilter:c.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),t(p,{class:"col-4"},{default:l(()=>[t(k,{onSearch:c.handleSearch},null,8,["onSearch"])]),_:1}),t(p,{class:"col-2"},{default:l(()=>[t(D)]),_:1})]),_:1}),t(P,{class:"mt-4",striped:"",bordered:""},{default:l(()=>[t(B,null,{default:l(()=>[t(C,null,{default:l(()=>[t(d,{scope:"col"},{default:l(()=>[i("Cliente")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Nombre")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("CÃ³digo zeus")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Fecha")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Error")]),_:1})]),_:1})]),_:1}),t(x,null,{default:l(()=>[(h(!0),F(w,null,E(c.displayedTasks,(o,z)=>(h(),m(C,{key:z},{default:l(()=>[o.client!==null?(h(),m(r,{key:0},{default:l(()=>[i(u(o.client.name),1)]),_:2},1024)):(h(),m(r,{key:1})),t(r,null,{default:l(()=>[i(u(o.device.zeusName),1)]),_:2},1024),t(r,null,{default:l(()=>[i(u(o.device.zeusCode),1)]),_:2},1024),t(r,null,{default:l(()=>[i(u(o.last_error.updated_at),1)]),_:2},1024),t(r,null,{default:l(()=>[i(u(o.last_error.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n("div",R,[t(S,{"total-items":c.filteredTasks.length,"items-per-page":_.perPage,"max-pages-shown":5,modelValue:_.currentPage,"onUpdate:modelValue":s[0]||(s[0]=o=>_.currentPage=o)},{"prev-button":l(()=>[j]),"next-button":l(()=>[A]),_:1},8,["total-items","items-per-page","modelValue"])])],64)}const K=V(I,[["render",U]]);export{K as default};
