import{r as z,a as i,b as d,d as h,e,_ as E,j as g,w as t,F as p,f as s,g as N,c as b,n as L,t as r}from"./index-BRhVHlva.js";import{D as H,C as V,a as A}from"./DeviceFilter-BtHzR4cS.js";import{_ as R}from"./SearchFilter-CeeZP-ln.js";const U={class:"mt-4"},j={__name:"EnabledFilter",emits:["filter"],setup(l,{emit:a}){const f=z(!1),v=a,F=u=>{v("filter",!f.value)};return(u,m)=>{const _=i("CFormSwitch");return d(),h("div",U,[e(_,{size:"xl",label:"Habilitado",modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=C=>f.value=C),onChange:F},null,8,["modelValue"])])}}},P={name:"FailedTasks",components:{DatePicker:H,ClientFilter:V,DeviceFilter:A,SearchBarFilter:R,EnabledFilter:j},data(){return{statusTasks:[],showModal:[],searchFilter:"",enabledFilter:!1,clientsFilter:[],devicesFilter:[],totalDevices:[]}},computed:{filteredTasks(){let l=[...this.statusTasks];return this.clientsFilter.length>0&&(l=l.filter(a=>this.clientsFilter.includes(a.client_id)),console.log("Filter tasks dentro de if: ",l)),this.devicesFilter.length>0&&this.devicesFilter.length<this.totalDevices.length&&(l=l.filter(a=>this.devicesFilter.includes(a.next_task.device_id))),this.enabledFilter&&(l=l.filter(a=>a.enabled===1)),this.searchFilter!==""&&(l=l.filter(a=>a.zeusName&&a.zeusName.toLowerCase().includes(this.searchFilter.toLowerCase())||a.client&&a.client.name.toLowerCase().includes(this.searchFilter.toLowerCase()))),console.log(l),l}},mounted(){this.getStatusTasks()},methods:{handleEnabled(l){this.enabledFilter=l,console.log("ENABLED:",this.enabledFilter)},handleSearch(l){this.searchFilter=l},handleClients(l){this.clientsFilter=l,this.getDevicesByClients()},handleDevices(l){this.devicesFilter=l,console.log(l)},async getStatusTasks(){const l=await g.get(this.$store.state.backendUrl+"/syncStatus",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.statusTasks=l.data,console.log(this.statusTasks)},async getDevicesByClients(){try{let l=[];for(const a of this.clientsFilter)l=(await g.get(this.$store.state.backendUrl+"/devices",{params:{client_id:a,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}})).data;this.totalDevices=l,this.devicesFilter=l}catch(l){console.error("Error en la solicitud a la API:",l),this.ShowError=!0}}}};function $(l,a,f,v,F,u){const m=i("ClientFilter"),_=i("CCol"),C=i("DeviceFilter"),k=i("EnabledFilter"),D=i("SearchBarFilter"),y=i("CRow"),c=i("CTableHeaderCell"),T=i("CTableRow"),S=i("CTableHead"),n=i("CTableDataCell"),w=i("CTableBody"),B=i("CTable");return d(),h(p,null,[e(y,null,{default:t(()=>[e(_,{class:"col-3"},{default:t(()=>[e(m,{onFilter:u.handleClients},null,8,["onFilter"])]),_:1}),e(_,{class:"col-3"},{default:t(()=>[e(C,{allDevices:F.devicesFilter,onFilter:u.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),e(_,{class:"col-2"},{default:t(()=>[e(k,{enabled:F.enabledFilter,onFilter:u.handleEnabled},null,8,["enabled","onFilter"])]),_:1}),e(_,{class:"col-4"},{default:t(()=>[e(D,{onSearch:u.handleSearch},null,8,["onSearch"])]),_:1})]),_:1}),e(B,{class:"mt-4"},{default:t(()=>[e(S,null,{default:t(()=>[e(T,{color:"dark"},{default:t(()=>[e(c,{scope:"col"},{default:t(()=>[s("Dispositivo")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Zeus")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Estado")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Ult. Sincronización")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Caudal")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("N. Freatico")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Totalizador")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Prox. Sincronización")]),_:1}),e(c,{scope:"col"},{default:t(()=>[s("Info")]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[(d(!0),h(p,null,N(u.filteredTasks,(o,x)=>(d(),b(T,{key:x,class:L({"table-success":o.sync_status.status==="ok","table-danger":o.sync_status.status==="error"})},{default:t(()=>[e(n,null,{default:t(()=>[s(r(o.zeusName),1)]),_:2},1024),e(n,null,{default:t(()=>[s(r(o.zeusCode),1)]),_:2},1024),e(n,null,{default:t(()=>[s(r(o.enabled),1)]),_:2},1024),o.last_task!==null?(d(),h(p,{key:0},[e(n,null,{default:t(()=>[s(r(o.last_task.taskDate),1)]),_:2},1024),e(n,null,{default:t(()=>[s(r(o.last_task.caudal),1)]),_:2},1024),e(n,null,{default:t(()=>[s(r(o.last_task.nivelFreatico),1)]),_:2},1024),e(n,null,{default:t(()=>[s(r(o.last_task.totalizador),1)]),_:2},1024)],64)):(d(),h(p,{key:1},[e(n,null,{default:t(()=>[s(" ")]),_:1}),e(n,null,{default:t(()=>[s(" ")]),_:1}),e(n,null,{default:t(()=>[s(" ")]),_:1}),e(n,null,{default:t(()=>[s(" ")]),_:1})],64)),o.next_task!==null?(d(),b(n,{key:2},{default:t(()=>[s(r(o.next_task.taskDate),1)]),_:2},1024)):(d(),b(n,{key:3},{default:t(()=>[s(" ")]),_:1})),e(n,null,{default:t(()=>[s(r(o.sync_status.message),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})],64)}const q=E(P,[["render",$]]);export{q as default};
