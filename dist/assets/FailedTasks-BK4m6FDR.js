import{_ as z,j as v,d as F,e as t,w as s,h as n,F as T,a,b as h,f as i,g as V,c as m,t as u}from"./index-BbNI8ARv.js";import{D as I,C as N,a as H}from"./DeviceFilter-B9QxAUo9.js";import{_ as L}from"./SearchFilter-CaQaq75L.js";const M={name:"FailedTasks",components:{DatePicker:I,ClientFilter:N,DeviceFilter:H,SearchBarFilter:L},data(){return{failTasks:[],showModal:[],searchFilter:"",clientsFilter:[],devicesFilter:[],totalDevices:[],selectedDevices:[],perPage:10,currentPage:1,totalPages:0}},computed:{displayedTasks(){const e=(this.currentPage-1)*this.perPage,l=e+this.perPage;return this.filteredTasks.slice(e,l)},filteredTasks(){let e=this.failTasks;return this.clientsFilter.length>0&&(e=e.filter(l=>this.clientsFilter.includes(l.last_error.client_id))),this.devicesFilter.length>0&&this.devicesFilter.length<this.totalDevices.length&&(e=e.filter(l=>this.devicesFilter.includes(l.last_error.device_id))),this.searchFilter!==""&&(e=e.filter(l=>l.device&&l.device.zeusName.toLowerCase().includes(this.searchFilter.toLowerCase())||l.client&&l.client.name.toLowerCase().includes(this.searchFilter.toLowerCase()))),e}},watch:{filteredTasks(){this.totalPages=Math.ceil(this.filteredTasks.length/this.perPage)}},mounted(){this.getFailedTasks()},methods:{handleSearch(e){this.searchFilter=e},handleClients(e){this.clientsFilter=e,this.getDevicesByClients()},handleDevices(e){this.selectedDevices.includes(e)||this.selectedDevices.push(e),console.log("DEVICES: ",this.selectedDevices)},async getFailedTasks(){const e=await v.get(this.$store.state.backendUrl+"/syncManual",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.failTasks=e.data,console.log(this.failTasks)},async getDevicesByClients(){try{let e=[];for(const l of this.clientsFilter){const g=await v.get(this.$store.state.backendUrl+"/devices",{params:{client_id:l,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});e=e.concat(g.data.map(f=>({...f,host:f.client_config.zeusHost})))}this.totalDevices=e,console.log("DISPOSITIVOS EN GETDEVICES: ",this.selectedDevices),this.selectedDevices.length===0&&(this.devicesFilter=e)}catch(e){console.error("Error en la solicitud a la API:",e),this.ShowError=!0}}}},R={class:"style-pagination mt-5"},j=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1),A=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1);function U(e,l,g,f,_,c){const w=a("ClientFilter"),p=a("CCol"),D=a("DeviceFilter"),b=a("SearchBarFilter"),k=a("CButton"),y=a("CRow"),d=a("CTableHeaderCell"),C=a("CTableRow"),B=a("CTableHead"),r=a("CTableDataCell"),x=a("CTableBody"),P=a("CTable"),S=a("vue-awesome-paginate");return h(),F(T,null,[t(y,null,{default:s(()=>[t(p,{class:"col-3"},{default:s(()=>[t(w,{onFilter:c.handleClients},null,8,["onFilter"])]),_:1}),t(p,{class:"col-3"},{default:s(()=>[t(D,{allDevices:_.devicesFilter,onFilter:c.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),t(p,{class:"col-4"},{default:s(()=>[t(b,{onSearch:c.handleSearch},null,8,["onSearch"])]),_:1}),t(p,{class:"col-2"},{default:s(()=>[t(k)]),_:1})]),_:1}),t(P,{class:"mt-4",striped:"",bordered:""},{default:s(()=>[t(B,null,{default:s(()=>[t(C,null,{default:s(()=>[t(d,{scope:"col"},{default:s(()=>[i("Cliente")]),_:1}),t(d,{scope:"col"},{default:s(()=>[i("Nombre")]),_:1}),t(d,{scope:"col"},{default:s(()=>[i("CÃ³digo zeus")]),_:1}),t(d,{scope:"col"},{default:s(()=>[i("Fecha")]),_:1}),t(d,{scope:"col"},{default:s(()=>[i("Error")]),_:1})]),_:1})]),_:1}),t(x,null,{default:s(()=>[(h(!0),F(T,null,V(c.displayedTasks,(o,E)=>(h(),m(C,{key:E},{default:s(()=>[o.client!==null?(h(),m(r,{key:0},{default:s(()=>[i(u(o.client.name),1)]),_:2},1024)):(h(),m(r,{key:1})),t(r,null,{default:s(()=>[i(u(o.device.zeusName),1)]),_:2},1024),t(r,null,{default:s(()=>[i(u(o.device.zeusCode),1)]),_:2},1024),t(r,null,{default:s(()=>[i(u(o.last_error.updated_at),1)]),_:2},1024),t(r,null,{default:s(()=>[i(u(o.last_error.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n("div",R,[t(S,{"total-items":c.filteredTasks.length,"items-per-page":_.perPage,"max-pages-shown":5,modelValue:_.currentPage,"onUpdate:modelValue":l[0]||(l[0]=o=>_.currentPage=o)},{"prev-button":s(()=>[j]),"next-button":s(()=>[A]),_:1},8,["total-items","items-per-page","modelValue"])])],64)}const J=z(M,[["render",U]]);export{J as default};
