import{_ as V,j as v,d as F,e as t,w as l,h as n,F as T,a as s,b as h,f as i,g as E,c as f,t as _}from"./index-3SSTsJ3w.js";import{D as H,C as M,a as N}from"./DeviceFilter-CtwBT3Q3.js";import{_ as I}from"./SearchFilter-Dr4j4Hqn.js";const R={name:"FailedTasks",components:{DatePicker:H,ClientFilter:M,DeviceFilter:N,SearchBarFilter:I},data(){return{failTasks:[],showModal:[],searchFilter:"",clientsFilter:[],devicesFilter:[],totalDevices:[],perPage:10,currentPage:1,totalPages:0}},computed:{displayedTasks(){const e=(this.currentPage-1)*this.perPage,a=e+this.perPage;return this.filteredTasks.slice(e,a)},filteredTasks(){let e=this.failTasks;return this.clientsFilter.length>0&&(e=e.filter(a=>this.clientsFilter.includes(a.last_error.client_id))),this.devicesFilter.length>0&&this.devicesFilter.length<this.totalDevices.length&&(e=e.filter(a=>this.devicesFilter.includes(a.last_error.device_id))),e}},watch:{filteredTasks(){this.totalPages=Math.ceil(this.filteredTasks.length/this.perPage)}},mounted(){this.getFailedTasks()},methods:{handleSearch(e){this.searchFilter=e},handleClients(e){this.clientsFilter=e,this.getDevicesByClients()},handleDevices(e){this.devicesFilter=e,console.log("DEVICES: ",e)},async getFailedTasks(){const e=await v.get(this.$store.state.backendUrl+"/syncManual",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.failTasks=e.data,console.log(this.failTasks)},async getDevicesByClients(){try{let e=[];for(const a of this.clientsFilter){const g=await v.get(this.$store.state.backendUrl+"/devices",{params:{client_id:a,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});e=e.concat(g.data.map(m=>({...m,host:m.client_config.zeusHost})))}this.totalDevices=e,this.devicesFilter=e}catch(e){console.error("Error en la solicitud a la API:",e),this.ShowError=!0}}}},j={class:"style-pagination mt-5"},A=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1),U=n("span",null,[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",width:"12",height:"12",viewBox:"0 0 24 24"},[n("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1);function L(e,a,g,m,c,u){const w=s("ClientFilter"),p=s("CCol"),k=s("DeviceFilter"),b=s("SearchBarFilter"),D=s("CButton"),y=s("CRow"),d=s("CTableHeaderCell"),C=s("CTableRow"),B=s("CTableHead"),r=s("CTableDataCell"),x=s("CTableBody"),P=s("CTable"),S=s("vue-awesome-paginate");return h(),F(T,null,[t(y,null,{default:l(()=>[t(p,{class:"col-3"},{default:l(()=>[t(w,{onFilter:u.handleClients},null,8,["onFilter"])]),_:1}),t(p,{class:"col-3"},{default:l(()=>[t(k,{allDevices:c.devicesFilter,onFilter:u.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),t(p,{class:"col-4"},{default:l(()=>[t(b,{onSearch:u.handleSearch},null,8,["onSearch"])]),_:1}),t(p,{class:"col-2"},{default:l(()=>[t(D)]),_:1})]),_:1}),t(P,{class:"mt-4",striped:"",bordered:""},{default:l(()=>[t(B,null,{default:l(()=>[t(C,null,{default:l(()=>[t(d,{scope:"col"},{default:l(()=>[i("Cliente")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Nombre")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("CÃ³digo zeus")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Fecha")]),_:1}),t(d,{scope:"col"},{default:l(()=>[i("Error")]),_:1})]),_:1})]),_:1}),t(x,null,{default:l(()=>[(h(!0),F(T,null,E(u.displayedTasks,(o,z)=>(h(),f(C,{key:z},{default:l(()=>[o.client!==null?(h(),f(r,{key:0},{default:l(()=>[i(_(o.client.name),1)]),_:2},1024)):(h(),f(r,{key:1})),t(r,null,{default:l(()=>[i(_(o.device.zeusName),1)]),_:2},1024),t(r,null,{default:l(()=>[i(_(o.device.zeusCode),1)]),_:2},1024),t(r,null,{default:l(()=>[i(_(o.last_error.updated_at),1)]),_:2},1024),t(r,null,{default:l(()=>[i(_(o.last_error.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n("div",j,[t(S,{"total-items":c.totalPages,"items-per-page":c.perPage,"max-pages-shown":5,modelValue:c.currentPage,"onUpdate:modelValue":a[0]||(a[0]=o=>c.currentPage=o)},{"prev-button":l(()=>[A]),"next-button":l(()=>[U]),_:1},8,["total-items","items-per-page","modelValue"])])],64)}const K=V(R,[["render",L]]);export{K as default};
