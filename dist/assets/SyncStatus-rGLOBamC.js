import{r as E,a as o,b as d,d as h,e,_ as z,j as k,w as t,F as p,f as a,g as H,c as b,n as N,t as r}from"./index-3SSTsJ3w.js";import{D as V,C as A,a as R}from"./DeviceFilter-CtwBT3Q3.js";import{_ as U}from"./SearchFilter-Dr4j4Hqn.js";const j={class:"mt-4"},P={__name:"EnabledFilter",emits:["filter"],setup(l,{emit:i}){const f=E(!1),v=i,F=u=>{v("filter",!f.value)};return(u,m)=>{const _=o("CFormSwitch");return d(),h("div",j,[e(_,{size:"xl",label:"Habilitado",modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=C=>f.value=C),onChange:F},null,8,["modelValue"])])}}},$={name:"FailedTasks",components:{DatePicker:V,ClientFilter:A,DeviceFilter:R,SearchBarFilter:U,EnabledFilter:P},data(){return{statusTasks:[],showModal:[],searchFilter:"",enabledFilter:!1,clientsFilter:[],devicesFilter:[],totalDevices:[]}},computed:{filteredTasks(){let l=[...this.statusTasks];return this.clientsFilter.length>0&&(l=l.filter(i=>this.clientsFilter.includes(i.client_id)),console.log("Filter tasks dentro de if: ",l)),this.devicesFilter.length>0&&this.devicesFilter.length<this.totalDevices.length&&(l=l.filter(i=>this.devicesFilter.includes(i.next_task.device_id))),this.enabledFilter&&(l=l.filter(i=>i.enabled===1)),console.log(l),l}},mounted(){this.getStatusTasks()},methods:{handleEnabled(l){this.enabledFilter=l,console.log("ENABLED:",this.enabledFilter)},handleSearch(l){this.searchFilter=l},handleClients(l){this.clientsFilter=l,this.getDevicesByClients()},handleDevices(l){this.devicesFilter=l,console.log(l)},async getStatusTasks(){const l=await k.get(this.$store.state.backendUrl+"/syncStatus",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.statusTasks=l.data,console.log(this.statusTasks)},async getDevicesByClients(){try{let l=[];for(const i of this.clientsFilter)l=(await k.get(this.$store.state.backendUrl+"/devices",{params:{client_id:i,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}})).data;this.totalDevices=l,this.devicesFilter=l}catch(l){console.error("Error en la solicitud a la API:",l),this.ShowError=!0}}}};function I(l,i,f,v,F,u){const m=o("ClientFilter"),_=o("CCol"),C=o("DeviceFilter"),g=o("EnabledFilter"),D=o("SearchBarFilter"),y=o("CRow"),c=o("CTableHeaderCell"),T=o("CTableRow"),S=o("CTableHead"),s=o("CTableDataCell"),B=o("CTableBody"),w=o("CTable");return d(),h(p,null,[e(y,null,{default:t(()=>[e(_,{class:"col-3"},{default:t(()=>[e(m,{onFilter:u.handleClients},null,8,["onFilter"])]),_:1}),e(_,{class:"col-3"},{default:t(()=>[e(C,{allDevices:F.devicesFilter,onFilter:u.handleDevices},null,8,["allDevices","onFilter"])]),_:1}),e(_,{class:"col-2"},{default:t(()=>[e(g,{enabled:F.enabledFilter,onFilter:u.handleEnabled},null,8,["enabled","onFilter"])]),_:1}),e(_,{class:"col-4"},{default:t(()=>[e(D,{onSearch:u.handleSearch},null,8,["onSearch"])]),_:1})]),_:1}),e(w,{class:"mt-4"},{default:t(()=>[e(S,null,{default:t(()=>[e(T,{color:"dark"},{default:t(()=>[e(c,{scope:"col"},{default:t(()=>[a("Dispositivo")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Zeus")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Estado")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Ult. Sincronización")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Caudal")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("N. Freatico")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Totalizador")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Prox. Sincronización")]),_:1}),e(c,{scope:"col"},{default:t(()=>[a("Info")]),_:1})]),_:1})]),_:1}),e(B,null,{default:t(()=>[(d(!0),h(p,null,H(u.filteredTasks,(n,x)=>(d(),b(T,{key:x,class:N({"table-success":n.sync_status.status==="ok","table-danger":n.sync_status.status==="error"})},{default:t(()=>[e(s,null,{default:t(()=>[a(r(n.zeusName),1)]),_:2},1024),e(s,null,{default:t(()=>[a(r(n.zeusCode),1)]),_:2},1024),e(s,null,{default:t(()=>[a(r(n.enabled),1)]),_:2},1024),n.last_task!==null?(d(),h(p,{key:0},[e(s,null,{default:t(()=>[a(r(n.last_task.taskDate),1)]),_:2},1024),e(s,null,{default:t(()=>[a(r(n.last_task.caudal),1)]),_:2},1024),e(s,null,{default:t(()=>[a(r(n.last_task.nivelFreatico),1)]),_:2},1024),e(s,null,{default:t(()=>[a(r(n.last_task.totalizador),1)]),_:2},1024)],64)):(d(),h(p,{key:1},[e(s,null,{default:t(()=>[a(" ")]),_:1}),e(s,null,{default:t(()=>[a(" ")]),_:1}),e(s,null,{default:t(()=>[a(" ")]),_:1}),e(s,null,{default:t(()=>[a(" ")]),_:1})],64)),n.next_task!==null?(d(),b(s,{key:2},{default:t(()=>[a(r(n.next_task.taskDate),1)]),_:2},1024)):(d(),b(s,{key:3},{default:t(()=>[a(" ")]),_:1})),e(s,null,{default:t(()=>[a(r(n.sync_status.message),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})],64)}const q=z($,[["render",I]]);export{q as default};
